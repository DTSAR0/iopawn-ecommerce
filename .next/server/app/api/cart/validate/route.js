(()=>{var e={};e.id=337,e.ids=[337],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4761:()=>{},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},15186:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>y,routeModule:()=>p,serverHooks:()=>m,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>l});var a={};r.r(a),r.d(a,{POST:()=>u});var s=r(44713),i=r(18198),o=r(84557),n=r(61768),d=r(24148);async function u(e){try{let{items:t}=await e.json();if(!t||!Array.isArray(t)||0===t.length)return n.NextResponse.json({isValid:!1,errors:[{productId:"general",message:"Cart is empty"}],warnings:[],validatedItems:[],totalPrice:0},{status:400});let r=[],a=[],s=[],i=t.map(e=>e.productId),o=await d.db.product.findMany({where:{id:{in:i}},include:{category:!0}}),u=new Map(o.map(e=>[e.id,e]));for(let e of t){let t=u.get(e.productId);if(!t){r.push({productId:e.productId,message:"Product not found"});continue}if(e.quantity<=0){r.push({productId:e.productId,message:"Quantity must be greater than 0"});continue}e.quantity>10&&a.push({productId:e.productId,message:"Large quantity detected - please contact support for bulk orders"});let i=t.stockQuantity,o=e.quantity>i,n=o?e.quantity-i:0;o&&a.push({productId:e.productId,message:`We don't have ${e.quantity} items of this product in stock. ${i} items will be shipped immediately, and ${n} items will be backordered. This will increase delivery time by 2-3 weeks.`}),s.push({productId:e.productId,quantity:e.quantity,price:t.priceCents/100,available:!0,stockQuantity:i,backorder:o,backorderQuantity:o?n:void 0,deliveryDelay:o?"2-3 weeks":void 0})}let p=s.some(e=>e.quantity>0),c=s.reduce((e,t)=>e+t.price*t.quantity,0),l={isValid:0===r.length&&p,errors:r,warnings:a,validatedItems:s,totalPrice:c};return n.NextResponse.json(l)}catch(e){return console.error("Cart validation error:",e),n.NextResponse.json({isValid:!1,errors:[{productId:"general",message:"Internal server error"}],warnings:[],validatedItems:[],totalPrice:0},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/cart/validate/route",pathname:"/api/cart/validate",filename:"route",bundlePath:"app/api/cart/validate/route"},resolvedPagePath:"/Users/dmytrotsariuk/Desktop/iopawn-ecommerce/app/api/cart/validate/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:c,workUnitAsyncStorage:l,serverHooks:m}=p;function y(){return(0,o.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:l})}},24148:(e,t,r)=>{"use strict";r.d(t,{db:()=>s});let a=require("@prisma/client"),s=global.db??new a.PrismaClient},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},68313:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[915,654],()=>r(15186));module.exports=a})();